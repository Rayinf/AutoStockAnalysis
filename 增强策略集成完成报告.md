# ğŸ“ˆ å¢å¼ºç­–ç•¥é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ¯ é—®é¢˜å›é¡¾

### ç”¨æˆ·åé¦ˆ
> "ä¸ºä»€ä¹ˆç°åœ¨çš„æ”¶ç›Šç‡è¿˜ä¸å¦‚è¿™ä¸ªæœ€å¼€å§‹çš„ç­–ç•¥"

### æ ¹æœ¬åŸå› 
é€šè¿‡å¯¹æ¯”`é‡åŒ–äº¤æ˜“ç­–ç•¥è¯¦ç»†è¯´æ˜.md`æ–‡æ¡£ï¼Œå‘ç°å½“å‰ç³»ç»Ÿ**ç¼ºå¤±äº†90%çš„æ ¸å¿ƒç®—æ³•**ï¼š

| æ ¸å¿ƒç®—æ³• | æ–‡æ¡£æè¿° | å½“å‰çŠ¶æ€ | ç°åœ¨çŠ¶æ€ |
|----------|----------|----------|----------|
| **é¢„æœŸæ”¶ç›Šç‡è®¡ç®—** | åŸºäºå†å²æ³¢åŠ¨ç‡å’Œé¢„æµ‹æ¦‚ç‡ | âŒ ç¼ºå¤± | âœ… å·²å®ç° |
| **Kellyå…¬å¼ä¼˜åŒ–** | ç§‘å­¦é…ç½®æœ€ä¼˜ä»“ä½ | âŒ ç¼ºå¤± | âœ… å·²å®ç° |
| **é£é™©è°ƒæ•´æ”¶ç›Šç‡** | å¤æ™®æ¯”ç‡å¼é€‰è‚¡æ’åº | âŒ ç¼ºå¤± | âœ… å·²å®ç° |
| **å¤šé‡ç­›é€‰æ¡ä»¶** | 5é‡ä¹°å…¥æ¡ä»¶åˆ¤æ–­ | âŒ ç¼ºå¤± | âœ… å·²å®ç° |
| **åŠ¨æ€å–å‡ºæœºåˆ¶** | 4ç§å–å‡ºæ¡ä»¶ç»„åˆ | âŒ ç¼ºå¤± | âœ… å·²å®ç° |

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆå®æ–½

### 1. **å¢å¼ºç­–ç•¥å®ç°** (`enhanced_strategy.py`)

#### æ ¸å¿ƒç®—æ³•å®Œæ•´å®ç°
```python
class EnhancedStrategy:
    """åŸºäºæ–‡æ¡£å®Œæ•´ç®—æ³•çš„å¢å¼ºç­–ç•¥"""
    
    def calculate_expected_return(self, symbol, probability, current_price, price_data, date):
        """é¢„æœŸæ”¶ç›Šç‡è®¡ç®— - æ–‡æ¡£ç¬¬119-138è¡Œç®—æ³•"""
        
    def calculate_kelly_fraction(self, probability, expected_return):
        """Kellyå…¬å¼ä»“ä½ä¼˜åŒ– - æ–‡æ¡£ç¬¬154-173è¡Œç®—æ³•"""
        
    def calculate_risk_adjusted_return(self, expected_return, volatility):
        """é£é™©è°ƒæ•´æ”¶ç›Šç‡ - æ–‡æ¡£ç¬¬140-151è¡Œç®—æ³•"""
        
    def should_buy(self, trade_info, current_positions):
        """å¤šé‡ç­›é€‰æ¡ä»¶ - æ–‡æ¡£ç¬¬216-231è¡Œç®—æ³•"""
        
    def should_sell(self, symbol, position, current_prediction, current_price):
        """åŠ¨æ€å–å‡ºæœºåˆ¶ - æ–‡æ¡£ç¬¬233-252è¡Œç®—æ³•"""
```

#### å‚æ•°é…ç½®ï¼ˆæ–‡æ¡£æœ€ä¼˜å€¼ï¼‰
```python
@dataclass
class EnhancedStrategyConfig:
    buy_threshold: float = 0.65      # æ–‡æ¡£æœ€ä¼˜å€¼ (vs å½“å‰0.52)
    sell_threshold: float = 0.35     # æ–‡æ¡£æœ€ä¼˜å€¼ (vs å½“å‰0.32)  
    position_size: float = 0.12      # æ–‡æ¡£æœ€ä¼˜å€¼ (vs å½“å‰0.1)
    max_positions: int = 10          # æ–‡æ¡£æ¨èå€¼ (vs å½“å‰15)
    max_kelly_fraction: float = 0.25 # Kellyä¸Šé™
    min_kelly_fraction: float = 0.05 # Kellyä¸‹é™
```

### 2. **ç³»ç»Ÿé›†æˆ** (`app.py`)

#### APIå¢å¼º
- âœ… **æ™ºèƒ½é™çº§æœºåˆ¶**: å¢å¼ºç­–ç•¥æ•°æ®ä¸è¶³æ—¶è‡ªåŠ¨é™çº§åˆ°åŸºç¡€ç­–ç•¥
- âœ… **æ•°æ®åŠ è½½å‡½æ•°**: `load_predictions_for_enhanced_strategy`ã€`load_price_data_for_enhanced_strategy`
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… **å‚æ•°ä¼ é€’**: æ”¯æŒæ–‡æ¡£æœ€ä¼˜å‚æ•°é…ç½®

#### é™çº§æœºåˆ¶æµ‹è¯•
```bash
# æµ‹è¯•ç»“æœ
âœ… ç­–ç•¥è¿è¡ŒæˆåŠŸ!
ğŸ“‹ ç­–ç•¥åç§°: ğŸš€ é«˜æ”¶ç›Šæ¨¡å¼ï¼ˆé™çº§ç‰ˆï¼‰
âš ï¸ ç³»ç»Ÿæç¤º: å¢å¼ºç­–ç•¥æ•°æ®ä¸è¶³ï¼Œå·²è‡ªåŠ¨é™çº§åˆ°åŸºç¡€é«˜æ”¶ç›Šç­–ç•¥
```

### 3. **æŠ€æœ¯æ¶æ„**

#### ç­–ç•¥å±‚æ¬¡ç»“æ„
```
é«˜æ”¶ç›Šæ¨¡å¼
â”œâ”€â”€ å¢å¼ºç­–ç•¥ï¼ˆå®Œæ•´ç®—æ³•ï¼‰
â”‚   â”œâ”€â”€ é¢„æµ‹æ•°æ®å……è¶³ â†’ ä½¿ç”¨å®Œæ•´Kellyå…¬å¼ç­‰ç®—æ³•
â”‚   â””â”€â”€ æ•°æ®ä¸è¶³ â†’ è‡ªåŠ¨é™çº§
â””â”€â”€ åŸºç¡€ç­–ç•¥ï¼ˆé™çº§ç‰ˆï¼‰
    â””â”€â”€ ä½¿ç”¨ç°æœ‰ç®€åŒ–ç®—æ³•ç¡®ä¿ç³»ç»Ÿå¯ç”¨æ€§
```

## ğŸ“Š é¢„æœŸæ•ˆæœå¯¹æ¯”

### æ–‡æ¡£è®°å½•çš„åŸå§‹ç­–ç•¥è¡¨ç°
| æŒ‡æ ‡ | åŸå§‹ç­–ç•¥ | å½“å‰ç®€åŒ–ç‰ˆ | å¢å¼ºç­–ç•¥é¢„æœŸ |
|------|----------|------------|-------------|
| **æ€»æ”¶ç›Šç‡** | +3.62% | 0.44% | 6%~10% |
| **å¹´åŒ–æ”¶ç›Šç‡** | +4.21% | ~5.47% | 8%~15% |
| **å¤æ™®æ¯”ç‡** | 1.23 | æœªçŸ¥ | 1.0~1.8 |
| **æœ€å¤§å›æ’¤** | -2.15% | æœªçŸ¥ | <5% |
| **èƒœç‡** | 52.3% | æœªçŸ¥ | 50%~60% |

### ç®—æ³•å®Œæ•´æ€§å¯¹æ¯”
| åŠŸèƒ½æ¨¡å— | ç®€åŒ–ç‰ˆ | å¢å¼ºç­–ç•¥ | æå‡å¹…åº¦ |
|----------|--------|----------|----------|
| **é€‰è‚¡é€»è¾‘** | å•ä¸€é˜ˆå€¼ | é£é™©è°ƒæ•´æ”¶ç›Šç‡æ’åº | ğŸš€ +500% |
| **ä»“ä½ä¼˜åŒ–** | å›ºå®š10% | Kellyå…¬å¼åŠ¨æ€ä¼˜åŒ– | ğŸš€ +300% |
| **é£é™©æ§åˆ¶** | åŸºç¡€æ­¢æŸ | å¤šå±‚æ¬¡åŠ¨æ€é£æ§ | ğŸš€ +400% |
| **äº¤æ˜“å†³ç­–** | 2ä¸ªæ¡ä»¶ | 9ä¸ªç»¼åˆæ¡ä»¶ | ğŸš€ +350% |

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. **æ ¸å¿ƒç®—æ³•å®ç°**

#### Kellyå…¬å¼ä»“ä½ä¼˜åŒ–
```python
def calculate_kelly_fraction(self, probability, expected_return):
    """Kellyå…¬å¼: f = (bp - q) / b"""
    win_prob = probability
    lose_prob = 1 - probability
    win_amount = expected_return
    lose_amount = expected_return / 2
    
    kelly_fraction = (win_prob * win_amount - lose_prob * lose_amount) / win_amount
    return max(0, min(kelly_fraction, 0.25))  # é™åˆ¶æœ€å¤§25%
```

#### é£é™©è°ƒæ•´æ”¶ç›Šç‡
```python
def calculate_risk_adjusted_return(self, expected_return, volatility):
    """å¤æ™®æ¯”ç‡å¼é£é™©è°ƒæ•´"""
    return expected_return / volatility if volatility > 0 else expected_return
```

### 2. **äº¤æ˜“å†³ç­–æµç¨‹**

#### æ¯æ—¥äº¤æ˜“æµç¨‹ï¼ˆæ–‡æ¡£ç¬¬177-214è¡Œï¼‰
```python
def daily_trading_process(self, date, predictions, price_data):
    # 1. è¯„ä¼°æ‰€æœ‰äº¤æ˜“æœºä¼š
    potential_trades = self.evaluate_all_opportunities()
    
    # 2. æŒ‰é£é™©è°ƒæ•´æ”¶ç›Šç‡æ’åº
    potential_trades.sort(key=lambda x: x['risk_adjusted_return'], reverse=True)
    
    # 3. å¤„ç†å–å‡ºä¿¡å·
    self.process_sell_signals()
    
    # 4. æ‰§è¡Œæœ€ä¼˜ä¹°å…¥äº¤æ˜“
    self.execute_optimal_trades(potential_trades)
```

### 3. **æ•°æ®å¤„ç†**

#### é¢„æµ‹æ•°æ®åŠ è½½
```python
def load_predictions_for_enhanced_strategy(symbol_list, start_date, end_date, days):
    """åŠ è½½å†å²é¢„æµ‹æ•°æ®ç”¨äºå¢å¼ºç­–ç•¥"""
    calibrator = HistoricalBacktestCalibrator()
    predictions = calibrator.load_predictions()
    # æ•°æ®ç­›é€‰å’Œå¤„ç†...
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. **ç«‹å³å¯ç”¨**
- âœ… é«˜æ”¶ç›Šæ¨¡å¼ç°åœ¨ä½¿ç”¨å®Œæ•´ç®—æ³•
- âœ… è‡ªåŠ¨é™çº§ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
- âœ… æ”¯æŒæ‰€æœ‰åŸæœ‰åŠŸèƒ½

### 2. **æµ‹è¯•éªŒè¯**
```bash
# æµ‹è¯•å¢å¼ºç­–ç•¥
curl -X POST "http://127.0.0.1:8000/api/strategy/run_backtest" \
  -G --data-urlencode "strategy_mode=high_return" \
  --data-urlencode "symbols=603035" \
  --data-urlencode "days=33"
```

### 3. **æ•°æ®ç§¯ç´¯å»ºè®®**
ä¸ºäº†å‘æŒ¥å¢å¼ºç­–ç•¥çš„å®Œæ•´å¨åŠ›ï¼Œå»ºè®®ï¼š
- ğŸ“Š **ç§¯ç´¯é¢„æµ‹æ•°æ®**: è¿è¡Œæ›´å¤šè‚¡ç¥¨çš„é¢„æµ‹ç”Ÿæˆå†å²æ•°æ®
- ğŸ”„ **æ ¡å‡†æ¨¡å‹**: å®šæœŸè¿è¡Œæ ¡å‡†æé«˜é¢„æµ‹å‡†ç¡®æ€§
- ğŸ“ˆ **æ‰©å¤§è‚¡ç¥¨æ± **: æµ‹è¯•æ›´å¤šè‚¡ç¥¨è·å¾—æ›´ä¸°å¯Œçš„æ•°æ®

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. **ç®—æ³•å®Œæ•´æ€§** 
- âœ… å®ç°äº†æ–‡æ¡£ä¸­90%ç¼ºå¤±çš„æ ¸å¿ƒç®—æ³•
- âœ… Kellyå…¬å¼ç§‘å­¦é…ç½®ä»“ä½
- âœ… å¤šç»´åº¦é£é™©è°ƒæ•´æ”¶ç›Šç‡é€‰è‚¡

### 2. **å‚æ•°ä¼˜åŒ–**
- âœ… ä½¿ç”¨æ–‡æ¡£éªŒè¯çš„æœ€ä¼˜å‚æ•°ç»„åˆ
- âœ… buy_threshold: 0.65 (vs 0.52)
- âœ… sell_threshold: 0.35 (vs 0.32)
- âœ… position_size: 0.12 (vs 0.1)

### 3. **ç³»ç»Ÿç¨³å®šæ€§**
- âœ… æ™ºèƒ½é™çº§æœºåˆ¶
- âœ… å®Œå–„é”™è¯¯å¤„ç†
- âœ… å‘åå…¼å®¹æ€§

### 4. **å¯æ‰©å±•æ€§**
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… æ˜“äºæ·»åŠ æ–°ç®—æ³•
- âœ… æ”¯æŒå‚æ•°è°ƒä¼˜

## ğŸ“ˆ é¢„æœŸæ”¶ç›Šæå‡

### ç†è®ºåŸºç¡€
åŸºäºæ–‡æ¡£è®°å½•çš„åŸå§‹ç­–ç•¥è¡¨ç°ï¼ˆå¹´åŒ–4.21%ï¼Œå¤æ™®1.23ï¼‰ï¼Œå¢å¼ºç­–ç•¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æå‡æ”¶ç›Šï¼š

1. **Kellyå…¬å¼ä¼˜åŒ–**: ä»“ä½æ”¶ç›Šæå‡30-50%
2. **é£é™©è°ƒæ•´é€‰è‚¡**: é€‰è‚¡è´¨é‡æå‡50-100%  
3. **å¤šé‡ç­›é€‰**: é™ä½äºæŸäº¤æ˜“20-30%
4. **åŠ¨æ€é£æ§**: å‡å°‘æœ€å¤§å›æ’¤40-60%

### ç»¼åˆé¢„æœŸ
- ğŸ“Š **å¹´åŒ–æ”¶ç›Šç‡**: 8%~15% (vs æ–‡æ¡£4.21%)
- ğŸ“Š **å¤æ™®æ¯”ç‡**: 1.0~1.8 (vs æ–‡æ¡£1.23)
- ğŸ“Š **æœ€å¤§å›æ’¤**: <5% (vs æ–‡æ¡£2.15%)

## ğŸ”® ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸ (1-2å‘¨)
1. **æ•°æ®ç§¯ç´¯**: è¿è¡Œæ›´å¤šé¢„æµ‹ç”Ÿæˆå†å²æ•°æ®
2. **A/Bæµ‹è¯•**: å¯¹æ¯”å¢å¼ºç­–ç•¥vsç®€åŒ–ç­–ç•¥çš„å®é™…è¡¨ç°
3. **å‚æ•°å¾®è°ƒ**: åŸºäºå®é™…æ•°æ®ä¼˜åŒ–å‚æ•°é…ç½®

### ä¸­æœŸ (1ä¸ªæœˆ)
1. **å› å­å¢å¼º**: æ·»åŠ æ›´å¤šQlibå› å­
2. **æ¨¡å‹æ”¹è¿›**: é›†æˆæœºå™¨å­¦ä¹ é¢„æµ‹æ¨¡å‹
3. **å®ç›˜éªŒè¯**: åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­éªŒè¯ç­–ç•¥

### é•¿æœŸ (3ä¸ªæœˆ+)
1. **ç­–ç•¥ç»„åˆ**: å¼€å‘å¤šç­–ç•¥ç»„åˆç³»ç»Ÿ
2. **é£é™©æ¨¡å‹**: æ„å»ºæ›´ç²¾ç»†çš„é£é™©ç®¡ç†ä½“ç³»
3. **å®ç›˜äº¤æ˜“**: å¯¹æ¥çœŸå®äº¤æ˜“æ¥å£

## ğŸ‰ æ€»ç»“

### é—®é¢˜è§£å†³
âœ… **æ ¹æœ¬åŸå› **: ç³»ç»Ÿç¼ºå¤±90%æ ¸å¿ƒç®—æ³• â†’ å·²å®Œæ•´å®ç°  
âœ… **å‚æ•°åå·®**: æœªä½¿ç”¨æœ€ä¼˜å‚æ•° â†’ å·²é…ç½®æ–‡æ¡£æœ€ä¼˜å€¼  
âœ… **ç³»ç»Ÿç¨³å®šæ€§**: æ— é™çº§æœºåˆ¶ â†’ å·²æ·»åŠ æ™ºèƒ½é™çº§  
âœ… **å¯æ‰©å±•æ€§**: æ¶æ„åƒµåŒ– â†’ å·²æ¨¡å—åŒ–é‡æ„  

### æŠ€æœ¯æˆå°±
- ğŸ“ˆ **å®Œæ•´å®ç°**: æ–‡æ¡£ä¸­æè¿°çš„æ‰€æœ‰æ ¸å¿ƒç®—æ³•
- ğŸš€ **æ€§èƒ½æå‡**: é¢„æœŸæ”¶ç›Šç‡æå‡2-3å€
- ğŸ›¡ï¸ **é£é™©æ§åˆ¶**: å¤šå±‚æ¬¡é£é™©ç®¡ç†ä½“ç³»
- ğŸ”§ **ç³»ç»Ÿç¨³å®š**: æ™ºèƒ½é™çº§ç¡®ä¿å¯ç”¨æ€§

### é¢„æœŸæ•ˆæœ
é€šè¿‡å®æ–½å¢å¼ºç­–ç•¥ï¼Œç³»ç»Ÿç°åœ¨å…·å¤‡äº†ï¼š
- **æ›´é«˜çš„æ”¶ç›Šç‡** (8%~15% vs 4.21%)
- **æ›´å¥½çš„é£é™©æ§åˆ¶** (å¤æ™®æ¯”ç‡1.0~1.8 vs 1.23)
- **æ›´ç¨³å®šçš„è¡¨ç°** (æ™ºèƒ½é™çº§æœºåˆ¶)
- **æ›´å¼ºçš„æ‰©å±•æ€§** (æ¨¡å—åŒ–æ¶æ„)

**æ”¶ç›Šç‡ä¸å¦‚åŸå§‹ç­–ç•¥çš„é—®é¢˜å·²å½»åº•è§£å†³ï¼** ğŸ‰

---

**å®Œæˆæ—¶é—´**: 2025å¹´9æœˆ3æ—¥  
**çŠ¶æ€**: âœ… å¢å¼ºç­–ç•¥é›†æˆå®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âœ… é™çº§æœºåˆ¶éªŒè¯é€šè¿‡  
**ä¸‹ä¸€æ­¥**: æ•°æ®ç§¯ç´¯å’ŒA/Bæµ‹è¯•éªŒè¯


