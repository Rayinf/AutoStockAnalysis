# 🔧 回测时间统一修改说明

## 📋 修改内容

### 问题描述
用户反馈高收益策略的回测天数应该与"回测时间范围"保持统一，而不是单独设置。

### ✅ 解决方案

#### 1. 移除独立的回测天数选择
**修改前**:
```typescript
{/* 高收益策略参数 */}
<div>
  <label>回测天数</label>
  <select value={testDays} onChange={...}>
    <option value={90}>3个月</option>
    <option value={180}>6个月</option>
    <option value={365}>1年 (推荐)</option>
    <option value={730}>2年</option>
  </select>
</div>
```

**修改后**:
```typescript
{/* 高收益策略特点 */}
<div className="p-3 bg-green-600/10 border border-green-600/30 rounded">
  <div className="text-sm font-medium text-green-300 mb-2">⚙️ 高收益策略特点</div>
  <div className="grid grid-cols-2 gap-3 text-xs">
    <div className="text-gray-300">
      <div className="text-xs font-medium mb-1">🎯 核心参数:</div>
      <div className="text-xs">• 信号阈值: 0.15 (激进)</div>
      <div className="text-xs">• 最大仓位: 8个</div>
      <div className="text-xs">• 单仓位: 25%</div>
      <div className="text-xs">• 止盈/止损: 15%/8%</div>
    </div>
    <div className="text-gray-300">
      <div className="text-xs font-medium mb-1">🤖 技术特色:</div>
      <div className="text-xs">• AI机器学习预测</div>
      <div className="text-xs">• 8大信号融合</div>
      <div className="text-xs">• 市场环境自适应</div>
      <div className="text-xs">• 动态仓位管理</div>
    </div>
  </div>
  <div className="mt-2 p-2 bg-green-600/20 rounded text-xs text-green-300">
    💡 回测时间范围将使用下方"回测时间范围"的设置
  </div>
</div>
```

#### 2. 添加回测天数计算函数
```typescript
// 计算回测天数的函数
const calculateBacktestDays = (): number => {
  if (useCustomDateRange && startDate && endDate) {
    const start = new Date(startDate)
    const end = new Date(endDate)
    const diffTime = Math.abs(end.getTime() - start.getTime())
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))
    return diffDays
  }
  // 如果不使用自定义范围，默认使用1年
  return 365
}
```

#### 3. 修改API调用逻辑
**修改前**:
```typescript
const params = new URLSearchParams({
  days: testDays.toString()  // 使用固定的testDays
})
```

**修改后**:
```typescript
const days = calculateBacktestDays()  // 动态计算天数
const params = new URLSearchParams({
  days: days.toString()
})

// 如果使用自定义日期范围，也可以传递给后端（可选）
if (useCustomDateRange && startDate && endDate) {
  params.append('start_date', startDate)
  params.append('end_date', endDate)
}
```

#### 4. 优化UI提示信息
```typescript
{/* 回测时间范围标题 */}
<div className="text-sm font-medium text-gray-400 mb-3">
  📅 回测时间范围
  {strategyType === 'high_return' && (
    <span className="ml-2 text-xs text-green-400">(高收益策略也使用此设置)</span>
  )}
</div>

{/* 动态提示信息 */}
{!useCustomDateRange && (
  <div className="text-xs text-gray-500">
    💡 {strategyType === 'high_return' 
        ? '高收益策略将使用过去1年的历史数据进行回测' 
        : '使用股票池中所有可用的历史数据进行回测'
    }
  </div>
)}

{useCustomDateRange && startDate && endDate && (
  <div className="text-xs text-green-500">
    📊 将使用 {startDate} 至 {endDate} 的数据进行回测 
    (约 {calculateBacktestDays()} 天)
  </div>
)}
```

## 🎯 用户体验改进

### 统一的时间控制
- ✅ 高收益策略和原始策略使用相同的时间范围设置
- ✅ 避免了重复配置的混乱
- ✅ 用户只需要在一个地方设置回测时间

### 智能提示
- ✅ 明确显示高收益策略也使用时间范围设置
- ✅ 动态显示计算出的回测天数
- ✅ 根据策略类型显示不同的提示信息

### 灵活的时间设置
- ✅ 支持"全部数据"模式（默认1年）
- ✅ 支持"自定义范围"模式（精确日期）
- ✅ 自动计算自定义范围的天数

## 📊 使用效果

### 高收益策略
- **全部数据模式**: 使用过去1年数据（365天）
- **自定义范围**: 使用用户指定的日期范围
- **提示信息**: 清楚显示将使用的时间范围

### 原始策略
- **全部数据模式**: 使用所有可用历史数据
- **自定义范围**: 使用用户指定的日期范围
- **参数配置**: 保持原有的详细参数设置

## ✅ 验证结果

- ✅ 语法检查通过，无编译错误
- ✅ 高收益策略时间设置统一
- ✅ UI提示信息清晰明确
- ✅ 保持了原有功能的完整性

现在用户可以在一个统一的地方控制所有策略的回测时间范围，避免了配置混乱！


