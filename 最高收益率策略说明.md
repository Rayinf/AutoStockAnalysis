# 🚀 基于最高收益率的量化交易策略

## 📊 策略概述

本策略实现了真正基于"最高收益率"的智能交易系统，不再是简单的阈值买卖，而是通过多维度评估选择最优交易机会。

## 🎯 核心策略逻辑

### 1. **预期收益率计算** (`calculate_expected_return`)

```python
# 基于历史波动率和预测概率计算预期收益
if probability > 0.5:
    expected_return = (probability - 0.5) * 2 * abs(avg_return) + volatility * (probability - 0.5)
else:
    expected_return = (probability - 0.5) * 2 * abs(avg_return) - volatility * (0.5 - probability)
```

**特点**：
- 结合历史平均收益率和波动率
- 根据预测概率动态调整预期收益
- 考虑市场波动性对收益的影响

### 2. **风险调整收益率** (`calculate_risk_adjusted_return`)

```python
# 风险调整：预期收益除以波动率
risk_adjusted_return = expected_return / volatility
```

**目的**：
- 不仅看收益，更要看风险调整后的收益
- 优先选择高收益低风险的标的
- 避免高风险低收益的交易

### 3. **Kelly公式仓位优化** (`calculate_kelly_fraction`)

```python
# Kelly公式: f = (bp - q) / b
kelly_fraction = (win_prob * win_amount - lose_prob * lose_amount) / win_amount
```

**优势**：
- 科学计算最优仓位比例
- 最大化长期收益率
- 控制单笔交易风险

## 🔄 交易决策流程

### 每日交易流程：

1. **📈 机会评估阶段**
   ```python
   for each stock prediction:
       calculate expected_return
       calculate risk_adjusted_return  
       calculate kelly_fraction
       add to potential_trades list
   ```

2. **🎯 策略排序**
   ```python
   # 按风险调整后收益率排序
   potential_trades.sort(key=lambda x: x['risk_adjusted_return'], reverse=True)
   ```

3. **💰 最优交易执行**
   ```python
   for top_trades:
       if meets_criteria:
           optimal_fraction = min(kelly_fraction, max_position_size)
           execute_trade(optimal_fraction)
   ```

## 📋 买入条件

多重筛选确保交易质量：

```python
buy_conditions = (
    expected_return > 0.005 and          # 预期收益 > 0.5%
    probability > buy_threshold and      # 预测概率 > 阈值
    symbol not in positions and         # 未持有该股票
    risk_adjusted_return > 0.1          # 风险调整收益 > 0.1
)
```

## 📊 卖出条件

```python
sell_conditions = (
    probability < sell_threshold         # 预测概率低于卖出阈值
)
```

## 🎨 策略优势

### 1. **智能选股**
- ✅ 不是所有信号都交易，只选最优机会
- ✅ 多维度评估：收益、风险、概率
- ✅ 动态排序，优先最佳标的

### 2. **科学仓位管理**
- ✅ Kelly公式优化仓位比例
- ✅ 风险控制，避免过度集中
- ✅ 资金利用率最大化

### 3. **风险调整**
- ✅ 考虑波动率，不盲目追求高收益
- ✅ 风险调整后收益率排序
- ✅ 多重安全阈值保护

## 📈 实际表现

### 策略对比：

| 指标 | 简单阈值策略 | 最高收益率策略 |
|------|-------------|----------------|
| 选股方式 | 概率>阈值即买入 | 多维度评估+排序 |
| 仓位管理 | 固定比例 | Kelly公式优化 |
| 风险控制 | 基础止损 | 风险调整收益率 |
| 交易频率 | 较高 | 精选优质机会 |

### 预期改进：

- 🎯 **更高胜率**：严格筛选条件
- 📊 **更好风险控制**：多重风险评估
- 💰 **更优资金利用**：Kelly公式仓位优化
- ⚡ **更智能决策**：综合排序选择

## 🔧 参数说明

| 参数 | 默认值 | 说明 |
|------|-------|------|
| `buy_threshold` | 0.6 | 买入概率阈值 |
| `sell_threshold` | 0.4 | 卖出概率阈值 |
| `expected_return_min` | 0.005 | 最小预期收益率 (0.5%) |
| `risk_adjusted_min` | 0.1 | 最小风险调整收益率 |
| `max_kelly_fraction` | 0.25 | Kelly公式最大仓位比例 |

## 🚀 使用方式

```python
# 运行最高收益率策略回测
config = StrategyConfig(
    buy_threshold=0.6,
    sell_threshold=0.4,
    max_positions=10,
    initial_capital=100000
)

result = backtester.run_backtest(config)
```

这个策略真正实现了"最高收益率"的核心理念：**不是简单的高频交易，而是精选最优机会，科学配置仓位，追求风险调整后的最大收益率**！

